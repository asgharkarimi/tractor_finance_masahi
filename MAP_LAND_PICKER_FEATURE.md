# قابلیت انتخاب زمین از نقشه

## ویژگی‌ها
این قابلیت به کاربر اجازه می‌دهد که:
- زمین خود را روی نقشه Google Maps مشاهده کند
- با کلیک روی نقشه، نقاط مرزی زمین را مشخص کند
- مساحت زمین به صورت خودکار محاسبه شود
- مساحت محاسبه شده به صورت خودکار در فیلد مساحت وارد شود

## نصب و راه‌اندازی

### 1. نصب پکیج‌ها
```bash
flutter pub get
```

### 2. دریافت Google Maps API Key

#### برای Android:
1. به [Google Cloud Console](https://console.cloud.google.com/) بروید
2. یک پروژه جدید بسازید یا پروژه موجود را انتخاب کنید
3. به بخش "APIs & Services" > "Credentials" بروید
4. روی "Create Credentials" > "API Key" کلیک کنید
5. API Key را کپی کنید
6. به بخش "APIs & Services" > "Library" بروید
7. "Maps SDK for Android" را جستجو و فعال کنید

#### برای iOS:
1. همان مراحل بالا را انجام دهید
2. "Maps SDK for iOS" را نیز فعال کنید

### 3. تنظیم API Key

#### Android:
فایل `android/app/src/main/AndroidManifest.xml` را باز کنید و `YOUR_API_KEY_HERE` را با API Key خود جایگزین کنید:

```xml
<meta-data
    android:name="com.google.android.geo.API_KEY"
    android:value="YOUR_ACTUAL_API_KEY"/>
```

#### iOS:
فایل `ios/Runner/AppDelegate.swift` را باز کنید و این کد را اضافه کنید:

```swift
import GoogleMaps

@UIApplicationMain
@objc class AppDelegate: FlutterAppDelegate {
  override func application(
    _ application: UIApplication,
    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
  ) -> Bool {
    GMSServices.provideAPIKey("YOUR_ACTUAL_API_KEY")
    GeneratedPluginRegistrant.register(with: self)
    return super.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
}
```

## نحوه استفاده

### در صفحه افزودن زمین:
1. روی دکمه نقشه (آیکون map) کنار فیلد مساحت کلیک کنید
2. صفحه نقشه باز می‌شود
3. روی نقشه کلیک کنید تا نقاط مرزی زمین را مشخص کنید
4. حداقل 3 نقطه نیاز است تا مساحت محاسبه شود
5. مساحت به صورت خودکار محاسبه و نمایش داده می‌شود
6. می‌توانید از دکمه "حذف آخرین نقطه" برای اصلاح استفاده کنید
7. روی "تایید و استفاده از این مساحت" کلیک کنید
8. مساحت به صورت خودکار در فیلد مساحت وارد می‌شود

## ویژگی‌های نقشه

### نوع نقشه:
- نقشه به صورت Hybrid (ترکیب ماهواره و نقشه) نمایش داده می‌شود
- برای مشاهده بهتر زمین‌های کشاورزی

### ابزارها:
- **My Location**: نمایش موقعیت فعلی کاربر
- **Zoom Controls**: بزرگنمایی و کوچکنمایی
- **Undo**: حذف آخرین نقطه
- **Clear**: پاک کردن همه نقاط

### محاسبه مساحت:
- از فرمول Shoelace برای محاسبه مساحت چندضلعی استفاده می‌شود
- تبدیل از درجه جغرافیایی به کیلومتر مربع
- تبدیل نهایی به هکتار (1 km² = 100 hectare)

## نکات مهم

### دقت محاسبات:
- محاسبات تقریبی هستند و برای زمین‌های بزرگ دقت بیشتری دارند
- برای زمین‌های کوچک‌تر ممکن است خطای کمی وجود داشته باشد
- برای دقت بیشتر، نقاط بیشتری را مشخص کنید

### مجوزها:
- اپلیکیشن نیاز به مجوز دسترسی به موقعیت مکانی دارد
- اولین بار که از نقشه استفاده می‌کنید، باید مجوز را بدهید

### اتصال اینترنت:
- برای بارگذاری نقشه نیاز به اتصال اینترنت دارید
- بدون اینترنت، نقشه نمایش داده نمی‌شود

## عیب‌یابی

### نقشه نمایش داده نمی‌شود:
1. API Key را چک کنید
2. مطمئن شوید که Maps SDK فعال است
3. اتصال اینترنت را بررسی کنید

### مساحت اشتباه محاسبه می‌شود:
1. مطمئن شوید که نقاط را به ترتیب مشخص کرده‌اید
2. از zoom مناسب استفاده کنید
3. نقاط بیشتری برای دقت بیشتر اضافه کنید

### خطای مجوز:
1. به تنظیمات اپلیکیشن بروید
2. مجوز Location را فعال کنید
